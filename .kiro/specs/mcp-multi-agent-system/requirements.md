# 需求文档 - 基于 MCP 的多智能体热点资讯分析系统

## 简介

本项目旨在构建一个基于 Microsoft Agent Framework 的多智能体协作系统，用于自动化热点资讯的获取、分析、内容生成和推送。系统将使用标准的 stdio 远程 MCP 服务器，通过 JSON 配置文件管理，每个智能体配备专门的 MCP 工具集，实现完整的工作流自动化。

## 需求列表

### 需求 1: 系统架构重构

**用户故事：** 作为系统架构师，我希望重新组织项目结构，清理冗余文件，建立清晰的模块化架构，以便后续开发和维护。

#### 验收标准

1. WHEN 项目启动时 THEN 系统应该有清晰的目录结构，包含 agents/、workflows/、config/、tools/ 等模块
2. WHEN 查看项目文件时 THEN 应该只保留必要的核心文件，移除所有旧版本和测试文件
3. IF 需要添加新功能 THEN 应该能够快速定位到对应的模块目录
4. WHEN 系统运行时 THEN 应该使用统一的配置管理机制，避免配置分散

### 需求 2: MCP 服务器标准化配置

**用户故事：** 作为开发者，我希望使用标准的 stdio 远程 MCP 服务器配置方式，通过 JSON 文件管理所有 MCP 服务，以便灵活地为不同智能体分配工具。

#### 验收标准

1. WHEN 系统初始化时 THEN 应该从 JSON 配置文件加载所有 MCP 服务器配置
2. WHEN 配置 MCP 服务器时 THEN 应该使用标准的 stdio 传输协议，支持 npx、uvx 等命令
3. IF MCP 服务器配置包含环境变量 THEN 系统应该正确设置并传递这些环境变量
4. WHEN 智能体需要工具时 THEN 应该能够从配置的 MCP 服务器动态获取可用工具列表
5. WHEN MCP 服务器连接失败时 THEN 系统应该提供清晰的错误信息和重试机制

### 需求 3: 热点资讯获取智能体

**用户故事：** 作为内容运营人员，我希望系统能够自动从多个来源获取最新的热点资讯，并进行初步筛选和排序，以便快速了解当前热点。

#### 验收标准

1. WHEN 智能体启动时 THEN 应该使用 RSS Reader MCP 工具获取多个新闻源的最新资讯
2. WHEN 获取资讯后 THEN 应该使用 Exa Search MCP 工具验证热点话题的热度和传播范围
3. IF 发现高热度话题 THEN 应该使用 Fetch MCP 工具获取详细内容
4. WHEN 完成资讯收集时 THEN 应该输出结构化的热点列表，包含标题、来源、热度指数、摘要
5. WHEN 资讯获取失败时 THEN 应该记录错误并继续处理其他来源

### 需求 4: 内容分析智能体

**用户故事：** 作为数据分析师，我希望系统能够深度分析热点资讯的内容、趋势和受众特征，提供数据支持的分析报告，以便制定内容策略。

#### 验收标准

1. WHEN 接收到热点资讯时 THEN 应该使用 Semantic Scholar MCP 工具搜索相关学术背景
2. WHEN 分析内容时 THEN 应该使用 LLM 能力提取关键词、主题和情感倾向
3. IF 需要可视化数据 THEN 应该使用 Chart Generator MCP 工具生成趋势图表
4. WHEN 完成分析时 THEN 应该输出包含数据洞察、趋势预测和受众画像的分析报告
5. WHEN 分析复杂话题时 THEN 应该使用 Structured Thinking MCP 工具进行结构化推理

### 需求 5: 内容生成智能体

**用户故事：** 作为内容创作者，我希望系统能够根据热点资讯和分析结果，自动生成多平台适配的高质量内容，以便快速发布。

#### 验收标准

1. WHEN 接收到分析报告时 THEN 应该根据平台特点生成不同风格的内容
2. WHEN 生成长文内容时 THEN 应该使用 Word Document MCP 工具创建专业文档
3. IF 内容需要配图 THEN 应该使用 OKPPT MCP 工具生成配图方案或使用 Browserbase 搜索图片
4. WHEN 生成内容时 THEN 应该确保内容符合平台规范（字数、格式、风格）
5. WHEN 完成内容生成时 THEN 应该输出多个版本的内容，包括微信、微博、抖音等平台

### 需求 6: 内容审核智能体

**用户故事：** 作为内容审核员，我希望系统能够自动检查生成内容的质量、合规性和品牌一致性，以便确保发布内容的专业性。

#### 验收标准

1. WHEN 接收到生成的内容时 THEN 应该检查语言风格、语法错误和逻辑连贯性
2. WHEN 审核内容时 THEN 应该使用 LLM 能力检测敏感词、违规内容和潜在风险
3. IF 发现问题 THEN 应该标记问题位置并提供修改建议
4. WHEN 审核通过时 THEN 应该为内容打分并添加审核标签
5. WHEN 审核不通过时 THEN 应该将内容返回给内容生成智能体重新生成

### 需求 7: 发布管理智能体

**用户故事：** 作为运营管理员，我希望系统能够管理内容的发布计划、平台选择和发布状态，以便协调多平台的内容发布。

#### 验收标准

1. WHEN 接收到审核通过的内容时 THEN 应该根据平台特点和时间策略制定发布计划
2. WHEN 制定计划时 THEN 应该使用 Chart Generator MCP 工具可视化发布时间表
3. IF 需要查看平台数据 THEN 应该使用 Browserbase MCP 工具访问平台后台
4. WHEN 发布内容时 THEN 应该记录发布状态、时间和平台信息
5. WHEN 发布失败时 THEN 应该自动重试并通知管理员

### 需求 8: 多智能体工作流编排

**用户故事：** 作为系统管理员，我希望系统能够灵活编排多个智能体的协作流程，支持顺序、并行和条件分支，以便应对不同的业务场景。

#### 验收标准

1. WHEN 启动工作流时 THEN 应该使用 WorkflowBuilder 定义智能体之间的协作关系
2. WHEN 执行工作流时 THEN 应该支持顺序执行（热点获取→分析→生成→审核→发布）
3. IF 需要加速处理 THEN 应该支持并行执行（同时生成多个平台的内容）
4. WHEN 遇到条件分支时 THEN 应该根据审核结果决定下一步操作（通过→发布，不通过→重新生成）
5. WHEN 工作流执行时 THEN 应该实时记录每个智能体的执行状态和输出

### 需求 9: DevUI 可视化界面

**用户故事：** 作为系统用户，我希望有一个友好的可视化界面，能够实时查看智能体工作状态、工具调用过程和输出结果，以便监控和调试系统。

#### 验收标准

1. WHEN 启动 DevUI 时 THEN 应该在浏览器中打开可视化界面
2. WHEN 工作流运行时 THEN 应该实时显示每个智能体的执行状态和进度
3. IF 智能体调用 MCP 工具 THEN 应该显示工具名称、参数和返回结果
4. WHEN 查看历史记录时 THEN 应该能够回溯之前的执行过程和结果
5. WHEN 需要调试时 THEN 应该能够单独测试某个智能体或工具

### 需求 10: 配置管理和环境变量

**用户故事：** 作为部署工程师，我希望系统能够通过配置文件和环境变量灵活管理 API 密钥、MCP 服务器地址等敏感信息，以便在不同环境中部署。

#### 验收标准

1. WHEN 系统启动时 THEN 应该从 .env 文件加载 API 密钥和配置
2. WHEN 配置 MCP 服务器时 THEN 应该支持通过环境变量传递认证信息
3. IF 缺少必要配置 THEN 应该提供清晰的错误提示和配置指南
4. WHEN 切换环境时 THEN 应该能够通过不同的配置文件快速切换
5. WHEN 配置更新时 THEN 应该支持热重载，无需重启系统

## 非功能性需求

### 性能需求
- 热点资讯获取延迟应小于 5 分钟
- 单个内容生成时间应小于 3 分钟
- 系统应支持至少 10 个并发工作流

### 可靠性需求
- MCP 服务器连接失败时应自动重试（最多 3 次）
- 智能体执行失败时应记录详细错误日志
- 系统应支持断点续传，避免重复处理

### 可维护性需求
- 代码应遵循模块化设计原则
- 每个智能体应独立可测试
- 配置文件应有详细的注释说明

### 安全性需求
- API 密钥应通过环境变量管理，不应硬编码
- 敏感信息应加密存储
- 系统应记录所有操作日志用于审计
