# 实现计划 - 基于 MCP 的多智能体热点资讯分析系统

## 任务清单

- [x] 1. 项目结构重构和清理




  - 创建清晰的目录结构（agents/、workflows/、config/、tools/、utils/）
  - 移除旧版本文件和冗余代码
  - 建立统一的配置管理机制
  - _需求: 1.1, 1.2, 1.3, 1.4_

- [x] 2. MCP 配置管理器实现




  - [x] 2.1 创建 MCPConfigManager 类

    - 实现从 JSON 文件加载 MCP 服务器配置
    - 实现配置验证和错误处理
    - 支持环境变量替换
    - _需求: 2.1, 2.2, 2.3_



  - [x] 2.2 实现智能体工具分配机制




    - 创建智能体与 MCP 工具的映射配置
    - 实现 get_tools_for_agent 方法
    - 支持动态工具加载
    - _需求: 2.4_

  - [x] 2.3 编写 MCP 配置管理器单元测试
    - 测试配置加载和解析
    - 测试错误处理和验证
    - 测试工具分配逻辑
    - _需求: 2.1, 2.2, 2.3, 2.4_

- [-] 3. DeepSeek 适配器优化


  - [x] 3.1 优化 DeepSeek 适配器



    - 确保与 Agent Framework 完全兼容
    - 优化消息格式转换逻辑
    - 添加错误处理和重试机制
    - _需求: 10.1_

  - [x] 3.2 测试 DeepSeek 适配器






    - 测试基本对话功能
    - 测试工具调用功能
    - 测试流式输出功能
    - _需求: 10.1_

- [x] 4. 热点获取智能体实现




  - [x] 4.1 创建 HotspotAgent 类


    - 实现智能体初始化和配置
    - 编写详细的 instructions
    - 配置 MCP 工具（RSS Reader、Exa Search、Fetch）
    - _需求: 3.1, 3.2, 3.3_

  - [x] 4.2 实现热点数据模型

    - 创建 Hotspot 数据类
    - 实现数据验证和序列化
    - _需求: 3.4_

  - [x] 4.3 测试热点获取功能












    - 测试 RSS 新闻源获取


    - 测试热度验证
    - 测试详细内容获取
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_


- [x] 5. 内容分析智能体实现




  - [x] 5.1 创建 AnalysisAgent 类

    - 实现智能体初始化和配置
    - 编写详细的 instructions
    - 配置 MCP 工具（Semantic Scholar、Chart Generator、Structured Thinking）
    - _需求: 4.1, 4.2_

  - [x] 5.2 实现分析报告数据模型

    - 创建 AnalysisReport 数据类
    - 实现数据验证和序列化
    - _需求: 4.4_

  - [ ]* 5.3 测试内容分析功能
    - 测试学术背景搜索
    - 测试关键词提取和情感分析
    - 测试图表生成
    - 测试结构化推理
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 6. 内容生成智能体实现



  - [x] 6.1 创建 ContentAgent 类

    - 实现智能体初始化和配置
    - 编写详细的 instructions（支持多平台）
    - _需求: 5.1, 5.2_

  - [x] 6.2 实现内容数据模型


    - 创建 Content 数据类
    - 支持多平台内容格式
    - 实现数据验证和序列化
    - _需求: 5.4_

  - [ ]* 6.3 测试内容生成功能
    - 测试微信公众号文章生成
    - 测试微博短文生成
    - 测试抖音视频脚本生成
    - 测试配图方案生成
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 7. 内容审核智能体实现
  - [ ] 7.1 创建 ReviewAgent 类
    - 实现智能体初始化和配置
    - 编写详细的审核标准 instructions
    - 实现内容安全检查器
    - _需求: 6.1, 6.2_

  - [ ] 7.2 实现审核结果数据模型
    - 创建 ReviewResult 数据类
    - 实现问题标记和建议生成
    - _需求: 6.4_

  - [ ]* 7.3 测试内容审核功能
    - 测试语言质量检查
    - 测试敏感词检测
    - 测试品牌一致性评估
    - 测试评分机制
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 8. 发布管理智能体实现
  - [ ] 8.1 创建 PublishAgent 类
    - 实现智能体初始化和配置
    - 编写发布策略 instructions
    - 配置 MCP 工具（Chart Generator、Browserbase、Desktop Commander）
    - _需求: 7.1, 7.2_

  - [ ] 8.2 实现发布计划数据模型
    - 创建 PublishPlan 数据类
    - 实现发布状态管理
    - _需求: 7.4_

  - [ ]* 8.3 测试发布管理功能
    - 测试发布计划制定
    - 测试时间表可视化
    - 测试发布状态记录
    - 测试重试机制
    - _需求: 7.1, 7.2, 7.3, 7.4, 7.5_


- [ ] 9. 顺序工作流实现
  - [ ] 9.1 创建顺序工作流构建函数
    - 使用 WorkflowBuilder 连接 5 个智能体
    - 实现热点获取→分析→生成→审核→发布流程
    - 添加工作流状态监控
    - _需求: 8.1, 8.2_

  - [ ]* 9.2 测试顺序工作流
    - 测试完整流程执行
    - 测试智能体间数据传递
    - 测试错误处理和恢复
    - _需求: 8.1, 8.2, 8.5_

- [ ] 10. 并行工作流实现
  - [ ] 10.1 创建并行工作流构建函数
    - 创建多个平台专用的内容生成智能体
    - 使用 WorkflowBuilder 实现并行执行
    - 实现结果聚合机制
    - _需求: 8.3_

  - [ ]* 10.2 测试并行工作流
    - 测试多平台并行生成
    - 测试并发性能
    - 测试结果聚合
    - _需求: 8.3, 8.5_

- [ ] 11. 条件工作流实现
  - [ ] 11.1 创建条件工作流构建函数
    - 实现审核结果判断逻辑
    - 使用 WorkflowBuilder 添加条件边
    - 实现审核不通过时的重新生成流程
    - _需求: 8.4_

  - [ ]* 11.2 测试条件工作流
    - 测试审核通过路径
    - 测试审核不通过路径
    - 测试循环重试机制
    - _需求: 8.4, 8.5_

- [ ] 12. 错误处理和重试机制
  - [ ] 12.1 实现 MCP 连接错误处理
    - 创建 MCPConnectionError 异常类
    - 实现指数退避重试机制
    - 添加详细的错误日志
    - _需求: 2.5_

  - [ ] 12.2 实现智能体执行错误处理
    - 创建 AgentExecutionError 异常类
    - 实现 safe_agent_run 包装函数
    - 添加错误上下文记录
    - _需求: 8.5_

  - [ ] 12.3 实现工作流执行错误处理
    - 实现 safe_workflow_run 包装函数
    - 添加工作流状态保存和恢复
    - 实现断点续传机制
    - _需求: 8.5_

- [ ] 13. 日志和监控系统
  - [ ] 13.1 配置日志系统
    - 实现 setup_logging 函数
    - 配置文件和控制台日志处理器
    - 实现日志轮转机制
    - _需求: 10.5_

  - [ ] 13.2 实现性能监控
    - 创建 monitor_performance 装饰器
    - 记录每个智能体的执行时间
    - 记录 MCP 工具调用延迟
    - _需求: 8.5_


- [ ] 14. DevUI 可视化界面集成
  - [ ] 14.1 创建 DevUI 启动脚本
    - 实现智能体注册
    - 配置 DevUI 服务器参数
    - 实现自动打开浏览器
    - _需求: 9.1_

  - [ ] 14.2 实现实时状态显示
    - 配置工作流事件监听
    - 实现智能体状态更新
    - 实现工具调用过程显示
    - _需求: 9.2, 9.3_

  - [ ] 14.3 实现历史记录功能
    - 保存工作流执行历史
    - 实现历史记录查询
    - 实现结果回溯
    - _需求: 9.4_

- [ ] 15. 配置管理和环境变量
  - [ ] 15.1 创建配置加载模块
    - 实现 load_secure_config 函数
    - 验证必需的环境变量
    - 提供清晰的错误提示
    - _需求: 10.1, 10.3_

  - [ ] 15.2 实现 MCP 环境变量支持
    - 支持在 MCP 配置中使用环境变量
    - 实现环境变量替换逻辑
    - _需求: 10.2_

  - [ ] 15.3 实现配置热重载
    - 监听配置文件变化
    - 实现配置动态更新
    - 避免系统重启
    - _需求: 10.5_

- [ ] 16. 安全机制实现
  - [ ] 16.1 实现内容安全检查器
    - 创建 ContentSafetyChecker 类
    - 实现敏感词检测
    - 实现内容长度检查
    - _需求: 6.2_

  - [ ] 16.2 实现访问控制
    - 创建 AccessControl 类
    - 实现 IP 白名单机制
    - 添加访问日志记录
    - _需求: 10.5_

- [ ] 17. 性能优化
  - [ ] 17.1 实现结果缓存机制
    - 创建 ResultCache 类
    - 实现缓存键生成
    - 实现 LRU 缓存策略
    - _需求: 8.5_

  - [ ] 17.2 实现并发控制
    - 创建 ConcurrencyController 类
    - 使用 Semaphore 限制并发数
    - 实现 run_with_limit 方法
    - _需求: 8.3_

- [ ] 18. 主程序和启动脚本
  - [ ] 18.1 创建主程序入口
    - 实现 main 函数
    - 集成所有模块
    - 提供交互式菜单
    - _需求: 1.1, 1.2, 1.3, 1.4_

  - [ ] 18.2 创建命令行接口
    - 支持命令行参数
    - 实现不同的启动模式（顺序/并行/条件/DevUI）
    - 提供帮助信息
    - _需求: 9.1_

  - [ ] 18.3 创建配置文件模板
    - 创建 .env.example 文件
    - 创建 mcp_servers.json 模板
    - 添加详细的配置说明
    - _需求: 10.1, 10.2, 10.3_


- [ ] 19. 文档和示例
  - [ ] 19.1 创建 README 文档
    - 编写项目简介和特性
    - 编写安装和配置指南
    - 编写使用示例
    - 添加常见问题解答
    - _需求: 1.1, 1.2, 1.3, 1.4_

  - [ ] 19.2 创建 API 文档
    - 文档化所有智能体的接口
    - 文档化数据模型
    - 文档化配置选项
    - _需求: 1.1, 1.2, 1.3, 1.4_

  - [ ] 19.3 创建使用示例
    - 编写基本使用示例
    - 编写高级使用示例
    - 编写自定义扩展示例
    - _需求: 1.1, 1.2, 1.3, 1.4_

- [ ] 20. 集成测试和验证
  - [ ]* 20.1 端到端测试
    - 测试完整的工作流执行
    - 测试所有智能体的协作
    - 测试 MCP 工具的集成
    - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_

  - [ ]* 20.2 性能测试
    - 测试并发工作流性能
    - 测试 MCP 工具调用延迟
    - 测试系统在高负载下的稳定性
    - _需求: 8.5_

  - [ ]* 20.3 错误恢复测试
    - 测试 MCP 连接失败恢复
    - 测试智能体执行失败恢复
    - 测试工作流中断恢复
    - _需求: 2.5, 8.5_

## 任务执行顺序建议

### 第一阶段：基础设施（任务 1-3）
1. 项目结构重构
2. MCP 配置管理器
3. DeepSeek 适配器优化

### 第二阶段：智能体实现（任务 4-8）
4. 热点获取智能体
5. 内容分析智能体
6. 内容生成智能体
7. 内容审核智能体
8. 发布管理智能体

### 第三阶段：工作流编排（任务 9-11）
9. 顺序工作流
10. 并行工作流
11. 条件工作流

### 第四阶段：系统完善（任务 12-17）
12. 错误处理和重试
13. 日志和监控
14. DevUI 集成
15. 配置管理
16. 安全机制
17. 性能优化

### 第五阶段：交付准备（任务 18-20）
18. 主程序和启动脚本
19. 文档和示例
20. 集成测试和验证

## 注意事项

1. **测试任务标记**：所有标记为 `*` 的测试任务为可选任务，可根据项目进度决定是否实施
2. **依赖关系**：某些任务有依赖关系，建议按照推荐的执行顺序进行
3. **MCP 工具**：确保所有需要的 MCP 工具已在配置文件中正确配置
4. **API 密钥**：在开始实施前，确保已配置好 DeepSeek API 密钥
5. **增量开发**：建议采用增量开发方式，每完成一个智能体就进行测试验证
